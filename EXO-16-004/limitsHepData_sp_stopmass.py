#!/usr/bin/env python
import os, sys
import numpy as np

if __name__ == '__main__':

    ### Luminosity
    lumi = 38.6
    signal = "stopdecaymass"

    ### Gather the results
    lifetimes = ['7.5e-08', '1.0e-07', '1.39058e-07', '1.58923e-07', '2.0e-07', '2.78116e-07', '2.97981e-07', '4.96636e-07', '5.0e-07', '5.16501e-07', '5.36366e-07', '5.56232e-07', '5.76097e-07', '6.15828e-07', '6.35694e-07', '7.0e-07', '1.0e-06', '1.43031e-06', '1.45018e-06', '1.62896e-06', '1.64883e-06', '1.96668e-06', '1.98654e-06', '2.0e-06', '3.43672e-06', '3.45658e-06', '4.46972e-06', '4.48959e-06', '4.50945e-06', '5.0e-06', '7.0e-06', '1.0e-05', '1.05883e-05', '1.06081e-05', '3.0e-05', '4.0e-05', '5.0e-05', '7.0e-05', '1.0e-04', '2.0e-04', '5.0e-04', '7.0e-04', '1.0e-03', '6.0e-03', '1.0e-02', '1.0e+01', '5.0e+02', '1.0e+03', '2.0e+03', '3.6e+03', '1.0e+04', '2.0e+04', '5.0e+04', '7.0e+04', '1.0e+05', '2.0e+05', '5.0e+05', '7.0e+05', '1.0e+06']
    obs = [549.397 ,613.714 ,665.527 ,674.194 ,690.11 ,718.436 ,731.889 ,786.603 ,759.575 ,760.338 ,754.618 ,753.598 ,733.949 ,713.572 ,725.95 ,745.999 ,761.548 ,747.127 ,751.137 ,753.786 ,745.737 ,744.896 ,733.887 ,746.831 ,747.056 ,740.911 ,732.107 ,731.876 ,735.283 ,738.101 ,740.501 ,742.326 ,742.326 ,743.389 ,744.074 ,744.074 ,744.074 ,744.074 ,744.074 ,744.075 ,744.074 ,744.074 ,744.074 ,744.074 ,744.074 ,744.075 ,745.926 ,744.563 ,738.481 ,726.734 ,716.398 ,699.523 ,692.895 ,689.772 ,678.856 ,653.672 ,652.648 ,641.577]
    exp = [523.296 ,564.699 ,596.795 ,608.534 ,624.266 ,644.645 ,644.895 ,666.32 ,670.045 ,671.7 ,671.291 ,674.391 ,676.956 ,676.884 ,678.276 ,685.706 ,688.885 ,692.5 ,693.359 ,694.528 ,697.94 ,695.739 ,695.13 ,697.206 ,696.75 ,695.526 ,696.724 ,698.311 ,697.883 ,697.549 ,696.963 ,695.88 ,695.88 ,698.125 ,701.771 ,701.771 ,701.771 ,701.771 ,701.771 ,701.771 ,701.771 ,701.771 ,701.771 ,701.771 ,701.771 ,701.771 ,697.721 ,695.308 ,692.135 ,682.284 ,671.309 ,656.666 ,650.931 ,644.76 ,633.273 ,617.805 ,610.348 ,605.517]
    up2 = [29.0654 ,49.882 ,63.38 ,51.6239 ,58.5137 ,67.4911 ,69.6923 ,87.3658 ,90.6526 ,83.1506 ,88.7672 ,87.1471 ,89.1042 ,90.0556 ,98.0313 ,107.143 ,102.112 ,98.8949 ,102.603 ,102.693 ,101.399 ,99.7494 ,101.314 ,97.7629 ,108.099 ,104.464 ,109.121 ,110.424 ,101.138 ,104.954 ,104.862 ,106.733 ,106.733 ,105.748 ,102.637 ,102.637 ,102.637 ,102.637 ,102.637 ,102.637 ,102.637 ,102.637 ,102.637 ,102.637 ,102.637 ,102.637 ,108.398 ,106.076 ,106.588 ,104.997 ,101.559 ,100.537 ,99.5793 ,101.925 ,98.4626 ,97.2511 ,98.0392 ,97.9262]
    up1 = [29.0654 ,23.5547 ,38.0893 ,36.1339 ,42.0528 ,40.0272 ,44.2948 ,51.7457 ,51.3941 ,46.5376 ,51.4001 ,49.8347 ,48.5725 ,49.7191 ,55.0499 ,56.4877 ,53.6354 ,53.4915 ,59.2763 ,54.4007 ,55.3193 ,55.2432 ,57.8397 ,56.2324 ,58.4862 ,57.8173 ,57.4784 ,52.8503 ,55.4303 ,55.4051 ,55.8097 ,59.4276 ,59.4275 ,57.8865 ,53.678 ,53.678 ,53.678 ,53.678 ,53.6779 ,53.678 ,53.6779 ,53.6779 ,53.678 ,53.678 ,53.678 ,53.678 ,54.9327 ,57.7147 ,59.8834 ,59.3248 ,56.2313 ,54.5098 ,53.1428 ,56.6901 ,55.115 ,52.3612 ,54.032 ,52.5746 ]
    dn2 = [63.3861 ,73.2685 ,77.8881 ,78.997 ,86.2005 ,92.2026 ,90.2776 ,98.4534 ,99.1688 ,101.647 ,102.015 ,104.756 ,104.591 ,102.766 ,107.088 ,107.181 ,109.054 ,109.684 ,108.6 ,113.997 ,115.315 ,115.052 ,113.816 ,119.338 ,112.453 ,112.894 ,113.765 ,116.485 ,115.81 ,117.795 ,116.91 ,114.669 ,114.669 ,115.744 ,119.865 ,119.865 ,119.865 ,119.865 ,119.865 ,119.865 ,119.865 ,119.865 ,119.865 ,119.865 ,119.865 ,119.865 ,114.942 ,116.261 ,116.028 ,115.261 ,115.772 ,114.461 ,111.91 ,111.701 ,110.072 ,107.893 ,107.851 ,107.487]
    dn1 = [38.0975 ,37.9914 ,39.4271 ,42.9651 ,43.8365 ,48.0728 ,45.828 ,50.9784 ,51.77 ,52.6876 ,51.1867 ,53.43 ,55.2411 ,55.528 ,55.9356 ,55.671 ,56.8923 ,58.336 ,63.013 ,60.9792 ,63.3534 ,61.6022 ,60.1277 ,61.9759 ,60.1282 ,60.9808 ,61.4374 ,62.3502 ,63.0789 ,63.1138 ,62.4648 ,59.3499 ,59.3499 ,61.0053 ,63.7361 ,63.7361 ,63.7361 ,63.7361 ,63.7361 ,63.736 ,63.7361 ,63.7361 ,63.7361 ,63.7361 ,63.7361 ,63.7361 ,63.5869 ,60.4596 ,61.5764 ,61.3128 ,61.4034 ,59.7921 ,61.5801 ,60.5705 ,56.4281 ,60.8709 ,57.2415 ,56.463]

    to_tev = 1e-3

    info  = "independent_variables:\n"
    info += "- header:\n"
    info += "    name: $\\tau$\n"
    info += "    units: s\n"
    info += "  values:\n"
    for lifetime in lifetimes:
        info += "  - value: {0}\n".format(lifetime)

    info += "dependent_variables:\n"
    info += "- header:\n"
    info += "    name: $\\mathrm{m}_{\\tilde{t}}$\n"
    info += "    units: GeV\n"
    info += "  qualifiers:\n"
    info += "  - {name: Limit, value: Observed}\n"
    #info += "  - {name: SQRT(S), units: GeV, value: 13000}\n"
    info += "  - {{name: LUMINOSITY, units: 'fb$^{{-1}}$', value: {0}}}\n".format(lumi)
    info += "  values:\n"

    for idx in range( len(obs) ):
        lim = obs[idx]
        info += "  - value: {0:.6g}\n".format(lim)

    info += "- header:\n"
    info += "    name: $\\mathrm{m}_{\\tilde{t}}$\n"
    info += "    units: GeV\n"
    info += "  qualifiers:\n"
    info += "  - {name: Limit, value: Expected}\n"
    #info += "  - {name: SQRT(S), units: GeV, value: 13000}\n"
    info += "  - {{name: LUMINOSITY, units: 'fb$^{{-1}}$', value: {0}}}\n".format(lumi)
    info += "  values:\n"

    for idx in range( len(exp) ):
        lim = exp[idx]
        lim_dn1 = dn1[idx]
        lim_dn2 = dn2[idx]
        lim_up1 = up1[idx]
        lim_up2 = up2[idx]
        info += "  - value: {0:.6g}\n".format(lim)
        info += "    errors:\n"
        info += "    - {{asymerror: {{plus: {0:.6g}, minus: {1:.6g}}}, label: '1 sigma'}}\n".format(lim_up1, -lim_dn1)
        info += "    - {{asymerror: {{plus: {0:.6g}, minus: {1:.6g}}}, label: '2 sigma'}}\n".format(lim_up2, -lim_dn2)

    #print info.rstrip("\n")

    with open("lim_{0}.yaml".format(signal), "w") as f:
        f.write(info)
