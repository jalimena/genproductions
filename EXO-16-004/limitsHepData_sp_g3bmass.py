#!/usr/bin/env python
import os, sys
import numpy as np

if __name__ == '__main__':

    ### Luminosity
    lumi = 38.6
    signal = "g3bdecaymass"

    ### Gather the results
    lifetimes = ['7.5e-08', '1.0e-07', '1.39058e-07', '1.58923e-07', '2.0e-07', '2.78116e-07', '2.97981e-07', '4.96636e-07', '5.0e-07', '5.16501e-07', '5.36366e-07', '5.56232e-07', '5.76097e-07', '6.15828e-07', '6.35694e-07', '7.0e-07', '1.0e-06', '1.43031e-06', '1.45018e-06', '1.62896e-06', '1.64883e-06', '1.96668e-06', '1.98654e-06', '2.0e-06', '3.43672e-06', '3.45658e-06', '4.46972e-06', '4.48959e-06', '4.50945e-06', '5.0e-06', '7.0e-06', '1.0e-05', '1.05883e-05', '1.06081e-05', '3.0e-05', '4.0e-05', '5.0e-05', '7.0e-05', '1.0e-04', '2.0e-04', '5.0e-04', '7.0e-04', '1.0e-03', '6.0e-03', '1.0e-02', '1.0e+01', '5.0e+02', '1.0e+03', '2.0e+03', '3.6e+03', '1.0e+04', '2.0e+04', '5.0e+04', '7.0e+04', '1.0e+05', '2.0e+05', '5.0e+05', '7.0e+05', '1.0e+06']
    obs = [1089.55 ,1195.63 ,1273.11 ,1290.42 ,1313.92 ,1369.46 ,1376.63 ,1468.39 ,1468.39 ,1410.51 ,1414.33 ,1402.61 ,1405.37 ,1382.7 ,1351.27 ,1363.03 ,1390.67 ,1411.98 ,1394.64 ,1400.48 ,1399.4 ,1398.04 ,1393.17 ,1382.16 ,1393.76 ,1398.3 ,1391.55 ,1371.89 ,1376.07 ,1380.76 ,1385.69 ,1388.45 ,1391.38 ,1391.38 ,1390.65 ,1390.65 ,1390.65 ,1393.27 ,1393.27 ,1390.65 ,1393.27 ,1390.65 ,1393.27 ,1393.27 ,1390.65 ,1393.27 ,1390.65 ,1391.85 ,1388.15 ,1384.77 ,1368.72 ,1352.19 ,1326.11 ,1318.59 ,1307.89 ,1294.65 ,1260.87 ,1250.37 ,1240.33]
    exp = [1047.45 ,1122.17 ,1171.27 ,1181.76 ,1210.99 ,1239.4 ,1244.45 ,1268.26 ,1279.82 ,1280.46 ,1282.51 ,1285.37 ,1286.3 ,1288.02 ,1287.82 ,1294.87 ,1305.29 ,1317.26 ,1311.54 ,1317.57 ,1318.44 ,1321.87 ,1325.69 ,1322.7 ,1325.08 ,1325.99 ,1325.08 ,1321.37 ,1320.19 ,1330.02 ,1325.64 ,1324.01 ,1326.83 ,1326.83 ,1328.8 ,1328.8 ,1328.8 ,1325.33 ,1325.33 ,1328.8 ,1325.33 ,1328.8 ,1325.33 ,1325.33 ,1328.8 ,1325.33 ,1328.8 ,1325.9 ,1320.27 ,1314.17 ,1298.19 ,1281.45 ,1258.6 ,1249.49 ,1240.18 ,1224.72 ,1197.25 ,1186.94 ,1177.4]
    up2 = [41.7085 ,69.0068 ,79.3782 ,92.1664 ,96.2077 ,117.51 ,112.676 ,138.051 ,125.462 ,125.934 ,100.542 ,127.089 ,129.243 ,131.437 ,138.803 ,170.333 ,140.048 ,149.056 ,168.594 ,147.594 ,146.709 ,147.224 ,145.477 ,144.104 ,144.866 ,149.523 ,147.072 ,153.183 ,156.7 ,146.112 ,158.859 ,152.827 ,149.655 ,149.655 ,155.366 ,155.367 ,155.367 ,156.01 ,156.01 ,155.366 ,156.01 ,155.367 ,156.01 ,156.01 ,155.366 ,156.01 ,155.367 ,155.433 ,154.575 ,160.214 ,157.217 ,155.592 ,154.868 ,146.533 ,152.904 ,152.378 ,153.022 ,154.074 ,153.504]
    up1 = [41.7085 ,26.3539 ,51.6346 ,42.8768 ,65.404 ,68.4391 ,64.4581 ,89.076 ,74.2022 ,76.7958 ,79.8413 ,78.6468 ,79.6315 ,80.8865 ,81.2282 ,82.1517 ,82.4667 ,77.0426 ,83.4346 ,81.0694 ,78.7034 ,82.4359 ,66.5085 ,78.2662 ,77.2497 ,76.6673 ,77.3759 ,77.6642 ,81.9681 ,75.5335 ,80.5002 ,83.6865 ,76.6985 ,76.6983 ,82.6177 ,82.6177 ,82.6178 ,82.9145 ,82.9145 ,82.6177 ,82.9146 ,82.6178 ,82.9145 ,82.9145 ,82.6179 ,82.9144 ,82.6177 ,79.7898 ,83.5073 ,85.9595 ,80.4719 ,88.4804 ,88.8865 ,88.7042 ,85.3135 ,81.8339 ,84.0615 ,86.4288 ,84.3221]
    dn2 = [107.401 ,126.579 ,131.071 ,126.123 ,138.328 ,146.979 ,143.223 ,145.775 ,157.166 ,157.383 ,158.887 ,163.712 ,162.177 ,163.76 ,161.108 ,172.794 ,171.306 ,179.411 ,168.338 ,173.185 ,167.487 ,180.453 ,186.414 ,184.02 ,183.369 ,184.175 ,182.556 ,173.263 ,175.769 ,188.674 ,182.889 ,184.973 ,185.429 ,185.43 ,186.358 ,186.358 ,186.359 ,181.325 ,181.325 ,186.358 ,181.325 ,186.358 ,181.325 ,181.325 ,186.358 ,181.325 ,186.358 ,181.931 ,182.207 ,171.956 ,180.851 ,178.98 ,181.642 ,178.611 ,179.369 ,178.626 ,172.451 ,171.441 ,164.399]
    dn1 = [66.5422 ,65.191 ,62.4085 ,68.0287 ,75.2173 ,70.3562 ,74.2511 ,71.6584 ,82.9162 ,83.4249 ,76.2498 ,82.8329 ,81.5079 ,81.0667 ,85.4711 ,87.5518 ,87.9738 ,93.044 ,89.0143 ,92.841 ,92.0115 ,94.0381 ,98.3365 ,95.421 ,98.0578 ,97.284 ,98.4753 ,93.519 ,92.2474 ,100.616 ,100.248 ,96.2693 ,101.672 ,101.672 ,101.851 ,101.851 ,101.851 ,96.076 ,96.0759 ,101.851 ,96.0759 ,101.851 ,96.0759 ,96.076 ,101.851 ,96.0759 ,101.851 ,98.5955 ,94.1969 ,91.9949 ,95.2937 ,91.1322 ,97.249 ,91.4276 ,92.5903 ,96.4412 ,90.3711 ,89.015 ,88.7314]

    to_tev = 1e-3

    info  = "independent_variables:\n"
    info += "- header:\n"
    info += "    name: $\\tau$\n"
    info += "    units: s\n"
    info += "  values:\n"
    for lifetime in lifetimes:
        info += "  - value: {0}\n".format(lifetime)

    info += "dependent_variables:\n"
    info += "- header:\n"
    info += "    name: $\\mathrm{m}_{\\tilde{g}}$\n"
    info += "    units: GeV\n"
    info += "  qualifiers:\n"
    info += "  - {name: Limit, value: Observed}\n"
    #info += "  - {name: SQRT(S), units: GeV, value: 13000}\n"
    info += "  - {{name: LUMINOSITY, units: 'fb$^{{-1}}$', value: {0}}}\n".format(lumi)
    info += "  values:\n"

    for idx in range( len(obs) ):
        lim = obs[idx]
        info += "  - value: {0:.6g}\n".format(lim)

    info += "- header:\n"
    info += "    name: $\\mathrm{m}_{\\tilde{g}}$\n"
    info += "    units: GeV\n"
    info += "  qualifiers:\n"
    info += "  - {name: Limit, value: Expected}\n"
    #info += "  - {name: SQRT(S), units: GeV, value: 13000}\n"
    info += "  - {{name: LUMINOSITY, units: 'fb$^{{-1}}$', value: {0}}}\n".format(lumi)
    info += "  values:\n"

    for idx in range( len(exp) ):
        lim = exp[idx]
        lim_dn1 = dn1[idx]
        lim_dn2 = dn2[idx]
        lim_up1 = up1[idx]
        lim_up2 = up2[idx]
        info += "  - value: {0:.6g}\n".format(lim)
        info += "    errors:\n"
        info += "    - {{asymerror: {{plus: {0:.6g}, minus: {1:.6g}}}, label: '1 sigma'}}\n".format(lim_up1, -lim_dn1)
        info += "    - {{asymerror: {{plus: {0:.6g}, minus: {1:.6g}}}, label: '2 sigma'}}\n".format(lim_up2, -lim_dn2)

    #print info.rstrip("\n")

    with open("lim_{0}.yaml".format(signal), "w") as f:
        f.write(info)
