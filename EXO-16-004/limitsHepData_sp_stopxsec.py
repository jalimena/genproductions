#!/usr/bin/env python
import os, sys
import numpy as np

if __name__ == '__main__':

    ### Luminosity
    lumi = 38.6
    signal = "stopdecay"

    ### Gather the results
    lifetimes = ['7.5e-08', '1.0e-07', '1.39058e-07', '1.58923e-07', '2.0e-07', '2.78116e-07', '2.97981e-07', '4.96636e-07', '5.0e-07', '5.16501e-07', '5.36366e-07', '5.56232e-07', '5.76097e-07', '6.15828e-07', '6.35694e-07', '7.0e-07', '1.0e-06', '1.43031e-06', '1.45018e-06', '1.62896e-06', '1.64883e-06', '1.96668e-06', '1.98654e-06', '2.0e-06', '3.43672e-06', '3.45658e-06', '4.46972e-06', '4.48959e-06', '4.50945e-06', '5.0e-06', '7.0e-06', '1.0e-05', '1.05883e-05', '1.06081e-05', '3.0e-05', '4.0e-05', '5.0e-05', '7.0e-05', '1.0e-04', '2.0e-04', '5.0e-04', '7.0e-04', '1.0e-03', '6.0e-03', '1.0e-02', '1.0e+01', '5.0e+02', '1.0e+03', '2.0e+03', '3.6e+03', '1.0e+04', '2.0e+04', '5.0e+04', '7.0e+04', '1.0e+05', '2.0e+05', '5.0e+05', '7.0e+05', '1.0e+06']
    obs = [0.298006 ,0.152911 ,0.0925229 ,0.0853114 ,0.0735001 ,0.0569416 ,0.0505682 ,0.0316765 ,0.0397643 ,0.0395098 ,0.0414574 ,0.0418147 ,0.0496573 ,0.0594387 ,0.0532889 ,0.0446488 ,0.0391097 ,0.0442066 ,0.0426898 ,0.0417488 ,0.0447519 ,0.0450855 ,0.0496846 ,0.0443221 ,0.0442341 ,0.0466987 ,0.050471 ,0.0505742 ,0.0490762 ,0.0478712 ,0.0468682 ,0.0461195 ,0.0461196 ,0.045689 ,0.0454134 ,0.0454134 ,0.0454133 ,0.0454134 ,0.0454134 ,0.0454133 ,0.0454134 ,0.0454134 ,0.0454133 ,0.0454134 ,0.0454133 ,0.0454133 ,0.0446775 ,0.0452182 ,0.0477111 ,0.0529215 ,0.0579747 ,0.0672997 ,0.0716084 ,0.073733 ,0.0816677 ,0.103384 ,0.10438 ,0.116246]
    exp = [0.399111 ,0.253622 ,0.180996 ,0.160906 ,0.137831 ,0.112789 ,0.112512 ,0.0918384 ,0.0886908 ,0.0873265 ,0.0876621 ,0.0851541 ,0.0831331 ,0.0831896 ,0.0821126 ,0.0765941 ,0.0743483 ,0.0718738 ,0.0712981 ,0.0705223 ,0.0683048 ,0.0697268 ,0.0701259 ,0.0687761 ,0.0690703 ,0.0698659 ,0.0690871 ,0.0680681 ,0.0683414 ,0.068555 ,0.0689324 ,0.0696353 ,0.0696353 ,0.0681863 ,0.0659611 ,0.0659612 ,0.0659611 ,0.0659612 ,0.0659611 ,0.0659612 ,0.0659611 ,0.0659611 ,0.0659611 ,0.0659612 ,0.0659612 ,0.0659611 ,0.0684452 ,0.0700086 ,0.0721197 ,0.0790884 ,0.0876472 ,0.100526 ,0.106072 ,0.112661 ,0.126142 ,0.146877 ,0.15806 ,0.165753]
    up2 = [0.441869 ,0.320909 ,0.23821 ,0.211279 ,0.20047 ,0.175709 ,0.169465 ,0.15348 ,0.148989 ,0.152418 ,0.154048 ,0.155647 ,0.150855 ,0.146526 ,0.154788 ,0.142724 ,0.141979 ,0.13777 ,0.134109 ,0.144219 ,0.14176 ,0.144661 ,0.142855 ,0.152061 ,0.137337 ,0.140184 ,0.140243 ,0.14377 ,0.142947 ,0.147945 ,0.14689 ,0.143578 ,0.143578 ,0.142418 ,0.145698 ,0.145698 ,0.145698 ,0.145698 ,0.145698 ,0.145698 ,0.145698 ,0.145698 ,0.145698 ,0.145698 ,0.145698 ,0.145698 ,0.141281 ,0.148108 ,0.152842 ,0.168415 ,0.191619 ,0.222457 ,0.228632 ,0.245138 ,0.273392 ,0.316727 ,0.345666 ,0.364729]
    up1 = [0.220375 ,0.130534 ,0.0929447 ,0.0904095 ,0.0771395 ,0.0686319 ,0.064213 ,0.0586429 ,0.0575096 ,0.057816 ,0.0559304 ,0.0572328 ,0.0582008 ,0.0586452 ,0.0583552 ,0.053631 ,0.0533929 ,0.053167 ,0.0585294 ,0.0552782 ,0.0562173 ,0.0553474 ,0.0538883 ,0.0549606 ,0.0529836 ,0.0547064 ,0.0545808 ,0.054782 ,0.0559149 ,0.0561521 ,0.0556979 ,0.0525288 ,0.0525289 ,0.0532702 ,0.054407 ,0.054407 ,0.054407 ,0.0544069 ,0.054407 ,0.0544069 ,0.054407 ,0.054407 ,0.054407 ,0.0544069 ,0.054407 ,0.054407 ,0.056633 ,0.0541926 ,0.0574362 ,0.0632847 ,0.0711018 ,0.0803202 ,0.0896566 ,0.0939788 ,0.0970829 ,0.128315 ,0.128432 ,0.133396]
    dn2 = [0.110368 ,0.102012 ,0.0837189 ,0.0636133 ,0.0591094 ,0.0525928 ,0.0536035 ,0.0500543 ,0.0493003 ,0.0459501 ,0.0480592 ,0.0460413 ,0.0454805 ,0.0458144 ,0.0475699 ,0.0465393 ,0.0438215 ,0.041449 ,0.0420201 ,0.0415528 ,0.0398469 ,0.040332 ,0.0409664 ,0.0392524 ,0.0418429 ,0.0415637 ,0.0420749 ,0.0416708 ,0.0398074 ,0.040814 ,0.0410411 ,0.0419183 ,0.0419183 ,0.0407465 ,0.0386379 ,0.038638 ,0.0386379 ,0.038638 ,0.0386379 ,0.038638 ,0.0386379 ,0.0386379 ,0.0386379 ,0.038638 ,0.0386379 ,0.0386379 ,0.0414919 ,0.0420191 ,0.0435141 ,0.0475921 ,0.0520905 ,0.0599603 ,0.0631563 ,0.068282 ,0.0755053 ,0.0882124 ,0.095839 ,0.100758]
    dn1 = [0.110368 ,0.0556254 ,0.056838 ,0.0481424 ,0.0459919 ,0.0354497 ,0.0383755 ,0.0347105 ,0.0332381 ,0.0302854 ,0.0328187 ,0.0310484 ,0.029646 ,0.030207 ,0.0321813 ,0.030421 ,0.0283078 ,0.0272222 ,0.0291432 ,0.0270128 ,0.0263706 ,0.0269816 ,0.0280893 ,0.0269049 ,0.0278277 ,0.0279614 ,0.0274842 ,0.025387 ,0.0264262 ,0.0265131 ,0.0268262 ,0.0284174 ,0.0284173 ,0.0272121 ,0.0247924 ,0.0247924 ,0.0247924 ,0.0247924 ,0.0247924 ,0.0247924 ,0.0247924 ,0.0247924 ,0.0247924 ,0.0247924 ,0.0247924 ,0.0247924 ,0.0262967 ,0.027991 ,0.0297455 ,0.0326761 ,0.0351009 ,0.0398176 ,0.041437 ,0.0465131 ,0.051447 ,0.0582876 ,0.064538 ,0.0665603]

    to_tev = 1e-3

    info  = "independent_variables:\n"
    info += "- header:\n"
    info += "    name: $\\tau$\n"
    info += "    units: s\n"
    info += "  values:\n"
    for lifetime in lifetimes:
        info += "  - value: {0}\n".format(lifetime)

    info += "dependent_variables:\n"
    info += "- header:\n"
    info += "    name: $\\sigma(pp \\rightarrow \\tilde{t}\\tilde{t}) ~\\mathcal{B}(\\tilde{t} \\rightarrow t\\tilde{\\chi}^{0})$\n"
    info += "    units: pb\n"
    info += "  qualifiers:\n"
    info += "  - {name: Limit, value: Observed}\n"
    #info += "  - {name: SQRT(S), units: GeV, value: 13000}\n"
    info += "  - {{name: LUMINOSITY, units: 'fb$^{{-1}}$', value: {0}}}\n".format(lumi)
    info += "  values:\n"

    for idx in range( len(obs) ):
        lim = obs[idx]
        info += "  - value: {0:.6g}\n".format(lim)

    info += "- header:\n"
    info += "    name: $\\sigma(pp \\rightarrow \\tilde{t}\\tilde{t}) ~\\mathcal{B}(\\tilde{t} \\rightarrow t\\tilde{\\chi}^{0})$\n"
    info += "    units: pb\n"
    info += "  qualifiers:\n"
    info += "  - {name: Limit, value: Expected}\n"
    #info += "  - {name: SQRT(S), units: GeV, value: 13000}\n"
    info += "  - {{name: LUMINOSITY, units: 'fb$^{{-1}}$', value: {0}}}\n".format(lumi)
    info += "  values:\n"

    for idx in range( len(exp) ):
        lim = exp[idx]
        lim_dn1 = dn1[idx]
        lim_dn2 = dn2[idx]
        lim_up1 = up1[idx]
        lim_up2 = up2[idx]
        info += "  - value: {0:.6g}\n".format(lim)
        info += "    errors:\n"
        info += "    - {{asymerror: {{plus: {0:.6g}, minus: {1:.6g}}}, label: '1 sigma'}}\n".format(lim_up1, -lim_dn1)
        info += "    - {{asymerror: {{plus: {0:.6g}, minus: {1:.6g}}}, label: '2 sigma'}}\n".format(lim_up2, -lim_dn2)

    #print info.rstrip("\n")

    with open("lim_{0}.yaml".format(signal), "w") as f:
        f.write(info)
